{"ast":null,"code":"import _regeneratorRuntime from \"D:\\\\tutos\\\\Mern_shop\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"D:\\\\tutos\\\\Mern_shop\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"D:\\\\tutos\\\\Mern_shop\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"D:\\\\tutos\\\\Mern_shop\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\tutos\\\\Mern_shop\\\\frontend\\\\src\\\\pages\\\\PlaceOrder.jsx\";\n\nimport axios from 'axios';\nimport { faPencil } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React, { useContext, useEffect, useReducer } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport CheckoutSteps from '../components/CheckoutSteps';\nimport Footer from '../components/Footer';\nimport Navbar from '../components/Navbar';\nimport { toast } from 'react-toastify';\nimport { getError } from '../utils';\nimport { Store } from '../Store';\nimport '../styles/placeorder.css';\nimport LoadingBox from '../components/LoadingBox';\n\nvar reducer = function reducer(state, action) {\n  switch (action.type) {\n    case 'CREATE_REQUEST':\n      return _objectSpread({}, state, {\n        loading: true\n      });\n\n    case 'CREATE_SUCCESS':\n      return _objectSpread({}, state, {\n        loading: false\n      });\n\n    case 'CREATE_FAIL':\n      return _objectSpread({}, state, {\n        loading: false\n      });\n\n    default:\n      return state;\n  }\n};\n\nvar PlaceOrder = function PlaceOrder() {\n  var navigate = useNavigate();\n\n  var _useReducer = useReducer(reducer, {\n    loading: false\n  }),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      loading = _useReducer2[0].loading,\n      dispatch = _useReducer2[1];\n\n  var _useContext = useContext(Store),\n      state = _useContext.state,\n      ctxDispatch = _useContext.dispatch;\n\n  var cart = state.cart,\n      userInfo = state.userInfo; //price\n\n  var roundPrice = function roundPrice(num) {\n    return Math.round(num * 100 + Number.EPSILON) / 100;\n  };\n\n  cart.itemsPrice = roundPrice(cart.cartItems.reduce(function (a, c) {\n    return a + c.quantity * c.price;\n  }, 0));\n  cart.shippingPrice = cart.itemsPrice > 100 ? roundPrice(0) : roundPrice(10);\n  cart.taxPrice = roundPrice(0.20 * cart.itemsPrice); //for tax in Serbia 20%\n\n  cart.totalPrice = cart.itemsPrice + cart.shippingPrice + cart.taxPrice;\n\n  var placeOrderHandler = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _yield$axios$post, data;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              dispatch({\n                type: 'CREATE_REQUEST'\n              });\n              _context.next = 4;\n              return axios.post('/api/orders', {\n                orderItems: cart.cartItems,\n                shippingAddress: cart.shippingAddress,\n                paymentMethod: cart.paymentMethod,\n                itemsPrice: cart.itemsPrice,\n                shippingPrice: cart.shippingPrice,\n                taxPrice: cart.taxPrice,\n                totalPrice: cart.totalPrice\n              }, {\n                headers: {\n                  authorization: \"Bearer \".concat(userInfo.token)\n                }\n              });\n\n            case 4:\n              _yield$axios$post = _context.sent;\n              data = _yield$axios$post.data;\n              ctxDispatch({\n                type: 'CART_CLEAR'\n              });\n              dispatch({\n                type: 'CREATE_SUCCESS'\n              });\n              localStorage.removeItem('cartItems');\n              navigate(\"/order/\".concat(data.order._id));\n              _context.next = 16;\n              break;\n\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context[\"catch\"](0);\n              dispatch({\n                type: 'CREATE_FAIL'\n              });\n              toast.error(getError(_context.t0));\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 12]]);\n    }));\n\n    return function placeOrderHandler() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    if (!cart.paymentMethod) {\n      navigate('/payment');\n    }\n  }, [cart, navigate]); //if not isset payment, go to last step -> payment\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Navbar, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-container\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-row\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-col\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    className: \"order-title\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 21\n    }\n  }, \"Order Preview\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-col\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(CheckoutSteps, {\n    step1: true,\n    step2: true,\n    step3: true,\n    step4: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 21\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-row\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-col\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-shipping\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    className: \"order-shipping-title\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 25\n    }\n  }, \"Shipping:\"), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"order-shipping-info\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 25\n    }\n  }, cart.shippingAddress.fullName, \", \", cart.shippingAddress.address, \", \", cart.shippingAddress.postalCode, \", \", cart.shippingAddress.city, \", \", cart.shippingAddress.country, \" \", /*#__PURE__*/React.createElement(Link, {\n    to: \"/shipping\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 220\n    }\n  }, /*#__PURE__*/React.createElement(FontAwesomeIcon, {\n    icon: faPencil,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 241\n    }\n  }), \"Edit\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-payment\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 25\n    }\n  }, \"Payment:\"), /*#__PURE__*/React.createElement(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 25\n    }\n  }, cart.paymentMethod)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-items\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    className: \"order-items-title\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 25\n    }\n  }, \"Items:\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-cards\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 25\n    }\n  }, cart.cartItems.map(function (item) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"order-card\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 33\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"order-card-body\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: item.image,\n      alt: item.name,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 41\n      }\n    }), /*#__PURE__*/React.createElement(Link, {\n      to: \"/product/\".concat(item.slug),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 41\n      }\n    }, item.title)), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"order-card-footer\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 41\n      }\n    }, item.quantity), /*#__PURE__*/React.createElement(\"span\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 41\n      }\n    }, \"$\", item.price)));\n  })), /*#__PURE__*/React.createElement(Link, {\n    className: \"order-edit\",\n    to: \"/cart\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(FontAwesomeIcon, {\n    icon: faPencil,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 65\n    }\n  }), \"Edit\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-col\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    className: \"order-summary\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 21\n    }\n  }, \"Order Summary\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-summary-info\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 25\n    }\n  }, \"Items\"), /*#__PURE__*/React.createElement(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 25\n    }\n  }, \"$\", cart.itemsPrice.toFixed(2))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-summary-info\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 25\n    }\n  }, \"Shipping\"), /*#__PURE__*/React.createElement(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 25\n    }\n  }, \"$\", cart.shippingPrice.toFixed(2))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-summary-info\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 25\n    }\n  }, \"Tax\"), /*#__PURE__*/React.createElement(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 25\n    }\n  }, \"$\", cart.taxPrice.toFixed(2))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-summary-info\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 25\n    }\n  }, \"Total\"), /*#__PURE__*/React.createElement(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 25\n    }\n  }, \"$\", cart.totalPrice.toFixed(2))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"order-summary-button\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    onClick: placeOrderHandler,\n    disabled: cart.cartItems.length === 0,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 25\n    }\n  }, \"Place Order\")), loading && /*#__PURE__*/React.createElement(LoadingBox, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 33\n    }\n  })))), /*#__PURE__*/React.createElement(Footer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 7\n    }\n  }));\n};\n\nexport default PlaceOrder;","map":{"version":3,"sources":["D:/tutos/Mern_shop/frontend/src/pages/PlaceOrder.jsx"],"names":["axios","faPencil","FontAwesomeIcon","React","useContext","useEffect","useReducer","Link","useNavigate","CheckoutSteps","Footer","Navbar","toast","getError","Store","LoadingBox","reducer","state","action","type","loading","PlaceOrder","navigate","dispatch","ctxDispatch","cart","userInfo","roundPrice","num","Math","round","Number","EPSILON","itemsPrice","cartItems","reduce","a","c","quantity","price","shippingPrice","taxPrice","totalPrice","placeOrderHandler","post","orderItems","shippingAddress","paymentMethod","headers","authorization","token","data","localStorage","removeItem","order","_id","error","fullName","address","postalCode","city","country","map","item","image","name","slug","title","toFixed","length"],"mappings":"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","sourcesContent":["import axios from 'axios'\r\nimport { faPencil} from '@fortawesome/free-solid-svg-icons'\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\r\nimport React, { useContext, useEffect, useReducer } from 'react'\r\nimport { Link, useNavigate } from 'react-router-dom'\r\nimport CheckoutSteps from '../components/CheckoutSteps'\r\nimport Footer from '../components/Footer'\r\nimport Navbar from '../components/Navbar'\r\nimport {toast} from 'react-toastify'\r\nimport {getError} from '../utils' \r\nimport { Store } from '../Store'\r\nimport '../styles/placeorder.css'\r\nimport LoadingBox from '../components/LoadingBox'\r\n\r\nconst reducer = (state, action) => {\r\n    switch (action.type) {\r\n      case 'CREATE_REQUEST':\r\n        return { ...state, loading: true };\r\n      case 'CREATE_SUCCESS':\r\n        return { ...state, loading: false };\r\n      case 'CREATE_FAIL':\r\n        return { ...state, loading: false };\r\n      default:\r\n        return state;\r\n    }\r\n};\r\n\r\nconst PlaceOrder = () => {\r\n    const navigate = useNavigate();\r\n\r\n    const [{loading}, dispatch] = useReducer(reducer, {\r\n        loading: false,\r\n    });\r\n\r\n    const { state, dispatch: ctxDispatch } = useContext(Store);\r\n    const { cart, userInfo } = state;\r\n\r\n    //price\r\n    const roundPrice = (num) => Math.round(num * 100 + Number.EPSILON) / 100;\r\n    cart.itemsPrice = roundPrice(cart.cartItems.reduce((a, c) => a + c.quantity * c.price, 0));\r\n    cart.shippingPrice = cart.itemsPrice > 100 ? roundPrice(0) : roundPrice(10);\r\n    cart.taxPrice = roundPrice(0.20 * cart.itemsPrice); //for tax in Serbia 20%\r\n    cart.totalPrice = cart.itemsPrice + cart.shippingPrice + cart.taxPrice;\r\n\r\n    const placeOrderHandler = async () => {\r\n        try {\r\n          dispatch({ type: 'CREATE_REQUEST' });\r\n    \r\n          const { data } = await axios.post(\r\n            '/api/orders',\r\n            {\r\n              orderItems: cart.cartItems,\r\n              shippingAddress: cart.shippingAddress,\r\n              paymentMethod: cart.paymentMethod,\r\n              itemsPrice: cart.itemsPrice,\r\n              shippingPrice: cart.shippingPrice,\r\n              taxPrice: cart.taxPrice,\r\n              totalPrice: cart.totalPrice,\r\n            },\r\n            {\r\n              headers: {\r\n                authorization: `Bearer ${userInfo.token}`,\r\n              },\r\n            }\r\n          );\r\n          ctxDispatch({ type: 'CART_CLEAR' });\r\n          dispatch({ type: 'CREATE_SUCCESS' });\r\n          localStorage.removeItem('cartItems');\r\n          navigate(`/order/${data.order._id}`);\r\n        } catch (err) {\r\n          dispatch({ type: 'CREATE_FAIL' });\r\n          toast.error(getError(err));\r\n        }\r\n      };\r\n\r\n    useEffect(() => {\r\n        if (!cart.paymentMethod) {\r\n          navigate('/payment');\r\n        }\r\n    }, [cart, navigate]); //if not isset payment, go to last step -> payment\r\n\r\n  return (\r\n    <>\r\n      <Navbar />\r\n        <div className=\"order-container\">\r\n            <div className=\"order-row\">\r\n                <div className=\"order-col\">\r\n                    <h2 className='order-title'>Order Preview</h2>\r\n                </div>\r\n                <div className=\"order-col\">\r\n                    <CheckoutSteps step1 step2 step3 step4 ></CheckoutSteps>\r\n                </div>\r\n            </div>\r\n            <div className=\"order-row\">\r\n                <div className=\"order-col\">\r\n                    <div className=\"order-shipping\">\r\n                        <h4 className=\"order-shipping-title\">Shipping:</h4>\r\n                        <p className=\"order-shipping-info\">{cart.shippingAddress.fullName}, {cart.shippingAddress.address}, {cart.shippingAddress.postalCode}, {cart.shippingAddress.city}, {cart.shippingAddress.country} <Link to=\"/shipping\"><FontAwesomeIcon icon={faPencil} />Edit</Link></p>\r\n                    </div>\r\n                    <div className=\"order-payment\">\r\n                        <h4>Payment:</h4>\r\n                        <span>{cart.paymentMethod}</span>\r\n                    </div>\r\n                    <div className=\"order-items\">\r\n                        <h4 className=\"order-items-title\">Items:</h4>\r\n                        <div className=\"order-cards\">\r\n                            {cart.cartItems.map((item) => (\r\n                                <div className=\"order-card\">\r\n                                    <div className=\"order-card-body\">\r\n                                        <img src={item.image} alt={item.name} />\r\n                                        <Link to={`/product/${item.slug}`}>{item.title}</Link>\r\n                                    </div>\r\n                                    <div className=\"order-card-footer\">\r\n                                        <span>{item.quantity}</span>\r\n                                        <span>${item.price}</span>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                        <Link className='order-edit' to=\"/cart\"><FontAwesomeIcon icon={faPencil} />Edit</Link>\r\n                    </div>\r\n                </div>\r\n                <div className=\"order-col\">\r\n                    <h2 className='order-summary'>Order Summary</h2>\r\n                    <div className=\"order-summary-info\">\r\n                        <h4>Items</h4>\r\n                        <span>${cart.itemsPrice.toFixed(2)}</span>\r\n                    </div>\r\n                    <div className=\"order-summary-info\">\r\n                        <h4>Shipping</h4>\r\n                        <span>${cart.shippingPrice.toFixed(2)}</span>\r\n                    </div>\r\n                    <div className=\"order-summary-info\">\r\n                        <h4>Tax</h4>\r\n                        <span>${cart.taxPrice.toFixed(2)}</span>\r\n                    </div>\r\n                    <div className=\"order-summary-info\">\r\n                        <h3>Total</h3>\r\n                        <span>${cart.totalPrice.toFixed(2)}</span>\r\n                    </div>\r\n                    <div className=\"order-summary-button\">\r\n                        <button type=\"button\" onClick={placeOrderHandler} disabled={cart.cartItems.length === 0}>Place Order</button>\r\n                    </div>\r\n                    {loading && <LoadingBox></LoadingBox>}\r\n                </div>\r\n            </div>\r\n        </div>\r\n      <Footer />\r\n    </>\r\n  )\r\n}\r\n\r\nexport default PlaceOrder\r\n"]},"metadata":{},"sourceType":"module"}